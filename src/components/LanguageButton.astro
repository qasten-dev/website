---
import { getSafeCurrentLocale } from "@/utils/i18n";
import { getRelativeLocaleUrl } from "astro:i18n";

const currentLocale = getSafeCurrentLocale(Astro.currentLocale);
const { size, locale } = Astro.props;
const { pathname } = Astro.url;

const selected = locale === currentLocale;

const localeFreePathname = pathname.startsWith(`/${currentLocale}/`)
  ? pathname.replace(`/${currentLocale}`, "")
  : pathname;

const selectedClasses = selected
  ? "bg-secondary/80 text-foreground shadow-sm ring-2 ring-primary/20"
  : "text-muted-foreground border-2 border-border/50 hover:bg-secondary/50 hover:text-foreground hover:border-primary/30 cursor-pointer";

const sizeClasses = size === "lg" ? "px-7 py-3.5 text-lg" : "px-4 py-2 text-sm";
---

<button
  class={`${sizeClasses} rounded-lg font-semibold transition-all duration-200 ${selectedClasses}`}
  disabled={selected}
  onclick={selected
    ? undefined
    : `location='${getRelativeLocaleUrl(locale, localeFreePathname)}'`}
>
  {locale.toUpperCase()}
</button>
